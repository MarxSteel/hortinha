var map,theaterSearch=[],museumSearch=[],rucsToGeojson=function(e,t){for(var a=0,o=e.length,s={type:"FeatureCollection",features:[]},r=0;o>r;r++){var i=e[r];i.Type===t&&(s.features[a]={type:"Feature",id:a,properties:{NAME:i.Name,ADDRESS1:i["Street Address"],CITY:i.City,ZIP:i.Zip,DESCRIPTION:i.Description},geometry:{type:"Point",coordinates:[i.Latitude,i.Longitude]}},a++)}return s},mapquestOSM=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:19,subdomains:["otile1","otile2","otile3","otile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'}),boroughs=L.geoJson(null,{style:function(e){return{color:"black",fill:!1,opacity:1,clickable:!1}},onEachFeature:function(e,t){}});$.getJSON("data/boroughs.geojson",function(e){boroughs.addData(e)});var subwayLines=L.geoJson(null,{onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Division</th><td>"+e.properties.Division+"</td></tr><tr><th>Line</th><td>"+e.properties.Line+"</td></tr><table>";document.body.clientWidth<=767?t.on({click:function(t){$("#feature-title").html(e.properties.Line),$("#feature-info").html(a),$("#featureModal").modal("show")}}):t.bindPopup(a,{maxWidth:"auto",closeButton:!1})}}});$.getJSON("data/subways.geojson",function(e){});var theaters=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/restaurants.png",iconSize:[27,45],iconAnchor:[12,28],popupAnchor:[0,-27]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<div class='row map-popup'><div class='col-md-9'><span class='title'><strong>"+e.properties.NAME+"</strong></a><br><span class='description'>"+e.properties.DESCRIPTION+"</span><br><span class='address'>"+e.properties.ADDRESS1+"</span></div></div>";document.body.clientWidth<=767?t.on({click:function(t){$("#feature-title").html(e.properties.NAME),$("#feature-info").html(a),$("#featureModal").modal("show")}}):t.bindPopup(a,{maxWidth:"auto",closeButton:!1}),theaterSearch.push({name:t.feature.properties.NAME,source:"Theaters",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});$.getJSON("data/LocalFoodPlaces.json",function(e){theaters.addData(rucsToGeojson(e,"Restaurants"))});var museums=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/farmersmarkets.png",iconSize:[27,45],iconAnchor:[12,28],popupAnchor:[0,-27]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<div class='row map-popup'><div class='col-md-9'><span class='title'><strong>"+e.properties.NAME+"</strong></span><br><span class='description'>"+e.properties.DESCRIPTION+"</span><br><span class='address'>"+e.properties.ADDRESS1+"</span></div></div>";document.body.clientWidth<=767?t.on({click:function(t){$("#feature-title").html(e.properties.NAME),$("#feature-info").html(a),$("#featureModal").modal("show")}}):t.bindPopup(a,{maxWidth:"auto",closeButton:!1}),museumSearch.push({name:t.feature.properties.NAME,source:"Museums",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});if($.getJSON("data/LocalFoodPlaces.json",function(e){museums.addData(rucsToGeojson(e,"Farmers Market"))}),map=L.map("map",{zoom:15,center:[38.5750753,-121.4844454],layers:[mapquestOSM,theaters]}),document.body.clientWidth<=767)var isCollapsed=!0;else var isCollapsed=!1;var overlays={"<img src='assets/img/restaurants.png' width='27' height='45'>&nbsp;Restaurants":theaters,"<img src='assets/img/farmersmarkets.png' width='27' height='45'>&nbsp;Farmers Market":museums},layerControl=L.control.layers(overlays,{}).addTo(map),sidebar=L.control.sidebar("sidebar",{closeButton:!0,position:"left"}).addTo(map);$("#searchbox").click(function(){$(this).select()}),$(document).one("ajaxStop",function(){$("#loading").hide(),$("#searchbox").on("typeahead:opened",function(){$(".navbar-collapse.in").css("max-height",$(document).height()-$(".navbar-header").height()),$(".navbar-collapse.in").css("height",$(document).height()-$(".navbar-header").height())}).on("typeahead:closed",function(){$(".navbar-collapse.in").css("max-height",""),$(".navbar-collapse.in").css("height","")}),$(".twitter-typeahead").css("position","static"),$(".twitter-typeahead").css("display","block")}),"Microsoft Internet Explorer"==navigator.appName&&$("input").each(function(){""===$(this).val()&&""!==$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).focus(function(){$(this).val()===$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""===$(this).val()&&$(this).val($(this).attr("placeholder"))}))});